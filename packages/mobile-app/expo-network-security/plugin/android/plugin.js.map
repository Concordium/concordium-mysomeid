{"version":3,"file":"plugin.js","sourceRoot":"","sources":["../../src/android/plugin.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAA,0CAAoB;AACpB,8CAAwB;AACxB,uDAI8B;AAC9B,kFAAkF;AAElF,IAAM,mBAAmB,GAAG,cAAM,OAAA,wvBAkB/B,EAlB+B,CAkB/B,CAAC;AAEG,IAAM,iBAAiB,GAAiB,UAAC,MAAM;IACpD,MAAM,GAAG,IAAA,oCAAmB,EAAC,MAAM,EAAE,UAAA,MAAM;;QACzC,IAAM,eAAe,GAAG,8BAAa,CAAC,QAAQ,CAAC,yBAAyB,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;QAE5F,IAAI,WAAW,GAAkB,MAAA,MAAA,MAAM,CAAC,OAAO,0CAAE,OAAO,mCAAI,IAAI,CAAC;QACjE,IAAM,mBAAmB,GAAG,MAAM,CAAC,UAAU,CAAC,mBAAmB,CAAC;QAElE,eAAe,CAAC,CAAC,yBACZ,CAAC,MAAA,eAAe,aAAf,eAAe,uBAAf,eAAe,CAAE,CAAC,mCAAI,EAAE,CAAC,KAC7B,+BAA+B,EAAE,8BAA8B,GAChE,CAAC;QAEF,IAAM,GAAG,GAAG,cAAI,CAAC,IAAI,CAAC,mBAAmB,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;QAC/E,IAAI;YACF,YAAE,CAAC,SAAS,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;SACvB;QAAC,OAAM,CAAC,EAAE;YACT,IAAI,CAAA,MAAA,CAAC,CAAC,OAAO,0CAAE,OAAO,CAAC,gBAAgB,CAAC,MAAK,CAAC,CAAC,EAAG;gBAChD,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;gBACjB,MAAM,CAAC,CAAC;aACT;SACF;QAED,IAAM,kBAAkB,GAAG,cAAI,CAAC,IAAI,CAAC,GAAG,EAAE,6BAA6B,CAAC,CAAC;QACzE,OAAO,CAAC,GAAG,CAAC,kBAAkB,GAAG,kBAAkB,CAAC,CAAC;QACrD,YAAE,CAAC,aAAa,CAAC,kBAAkB,EAAE,mBAAmB,EAAE,CAAC,CAAC;QAE5D,OAAO,MAAM,CAAC;IAChB,CAAC,CAAC,CAAC;IAEH,OAAO,MAAM,CAAC;AAChB,CAAC,CAAC;AA9BW,QAAA,iBAAiB,qBA8B5B","sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport {\n  AndroidConfig,\n  ConfigPlugin,\n  withAndroidManifest,\n} from \"@expo/config-plugins\";\n// import { ManifestActivity } from '@expo/config-plugins/build/android/Manifest';\n\nconst codeNetworkSecurity = () => `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<network-security-config>\n  <domain-config>\n    <domain-config cleartextTrafficPermitted=\"true\">\n      <domain includeSubdomains=\"true\">127.0.0.1</domain>\n      <domain includeSubdomains=\"true\">10.0.0.1</domain>\n      <domain includeSubdomains=\"true\">10.0.1.1</domain>\n      <domain includeSubdomains=\"true\">10.0.2.2</domain>\n      <domain includeSubdomains=\"true\">localhost</domain>\n    </domain-config>\n    <domain includeSubdomains=\"true\">mysomeid.dev</domain>\n    <domain includeSubdomains=\"true\">mysome.id</domain>\n    <trust-anchors>\n      <certificates src=\"user\"/>\n      <certificates src=\"system\"/>\n    </trust-anchors>\n  </domain-config>\n</network-security-config>\n\\n`;\n\nexport const withAndroidPlugin: ConfigPlugin = (config) => {\n  config = withAndroidManifest(config, config => {\n    const mainApplication = AndroidConfig.Manifest.getMainApplicationOrThrow(config.modResults);\n\n    let packageName: string | null = config.android?.package ?? null;\n    const platformProjectRoot = config.modRequest.platformProjectRoot;\n\n    mainApplication.$ = {\n      ...(mainApplication?.$ ?? {}),\n      'android:networkSecurityConfig': '@xml/network_security_config',\n    };\n\n    const dir = path.join(platformProjectRoot, 'app', 'src', 'main', 'res', 'xml');\n    try {\n      fs.mkdirSync(dir, {});\n    } catch(e) {\n      if (e.message?.indexOf('already exists') === -1 ) {\n        console.error(e);\n        throw e;\n      }\n    }\n\n    const fnNetworkSecCfgXml = path.join(dir, 'network_security_config.xml');\n    console.log(\"Creating file : \" + fnNetworkSecCfgXml);\n    fs.writeFileSync(fnNetworkSecCfgXml, codeNetworkSecurity());\n\n    return config;\n  });\n\n  return config;\n};\n"]}